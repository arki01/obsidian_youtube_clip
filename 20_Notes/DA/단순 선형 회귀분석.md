---
Created: 2023-10-22 22:12
tags:
  - AI/머신러닝
aliases: []
---

# 개요
[[지도학습]]의 회귀분석 방법 중 하나로 독립변수와 종속변수 간의 선형적인 관계를 도출하여 회귀(예측)하는 분석 기법이다.

# 내용
### 개념
- 독립변수와 종속변수 간에 선형적인 관계를 도출하여 독립변수가 종속변수에 미치는 영향을 분석하고, 독립변수를 통해 종속변수를 예측하는 분석기법
- 유투브 시청시간이 학생에게 영향을 미치는 것을 분석한다면
	- 독립변수가 유투브 시청시간이 되고,
	- 종속변수가 학성의 성적이 된다.
### 알고리즘
- 단순 선형 분석은 가장 단순한 분석으로 한 개의 종속변수 y와 한 개의 독립변수 x로 구성된 선형 회귀이다. 
  (a는 회귀계수, b는 y 절편)
$$y = ax + b$$
- 실제값과 회귀모델에 의해 예측한 값의 차이를 잔차(오류)라고하며, 잔차의 합의 최소가 되는 회귀 계수를 찾아내는게 회귀모델의 목표이다.
- 잔차는 +,-가 될 수 있기 때문에, 잔차의 제곱의 합(RSS)을 최소로 하는 최소제곱법을 이용하여 최소가 되는 모델을 만든다.
### 분석 수행
- 목표
	- UCI 자동차 연비 데이터셋을 사용하여 자동차 연비를 예측하는 모델을 만든다.
- 접근방법
	- 종속변수는 mpg(연비)로 한다.
	- mpg에 대해 나머지 변수들의 상관성을 산점도를 이용하여 시각적으로 분석한다.
	- 상관성이 있다고 판단되는 변수를 선택한 후 각가에 대해 선형 알고리즘을 적용하여 모델을 생성
	- 결정계수 값을 구하여 모델 성능을 평가
###### 필요 패키지 임포트
~~~python
## 단순 선형 회귀분석 알고리즘

## 1. 필요 패키지 임포트
import numpy as np
import pandas as pd
import sklearn
import matplotlib.pyplot as plt           # 맷플롯립 패키지 임포트

# 선형 회귀모델을 위한 패키지 임포트
from sklearn.linear_model import LinearRegression
# 학습 및 테스트 데이터셋 분리를 위한 패키지 임포트
from sklearn.model_selection import train_test_split
~~~
###### 데이터 불러오기
~~~python
## 2. 데이터 불러오기
df = pd.read_csv("https://raw.githubusercontent.com/plotly/datasets/master/auto-mpg.csv")
~~~
###### 데이터 탐색하기 & 변수 선택
- Matplotlib의 plot() 메소드에 kind='scatter' 옵션을 적용하여 산점도 그리기
	- y축에는 mpg열을 지정하고, x축에 각 열을 하나씩 지정하면서 두 변수의 상관성을 살펴본다.
	- 6개의 변수 중에서 housepower와 weight에 음의 상관관계가 있음을 알 수 있고, 이 두 변수에 선형회귀 모델을 만들어본다.
~~~python
## 3. 데이터 살펴보기 & 변수선택
df
df.info()

# 종속변수 mpg와 다른 변수들 간의 상관관계 분석
df.plot(kind='scatter', x='cylinders', y='mpg')
plt.show()

df.plot(kind='scatter', x='displacement', y='mpg')
plt.show()

df.plot(kind='scatter', x='horsepower', y='mpg')
plt.show()

df.plot(kind='scatter', x='weight', y='mpg')
plt.show()

df.plot(kind='scatter', x='acceleration', y='mpg')
plt.show()

df.plot(kind='scatter', x='model-year', y='mpg')
plt.show()
~~~

![[데이터분석_시각화_산점도_예시1.png]]
###### 데이터 전처리
~~~python
## 4. 데이터 전처리
# 결측값이 있는 행전체 제거 (axis가 1이면 열을 제거)
df = df.dropna(axis=0)
df.info()
~~~
###### 분석 데이터셋 준비
~~~python
## 5. 분석 데이터셋 준비
# 분석 데이터셋 준비 : weight-mpg 분석
X = df[["weight"]]        # 독립변수(설명변수)
y = df["mpg"]             # 종속변수(목표변수)

# 분석 데이터셋 분할(8:2)
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=10)

print(X_train.shape)
print(X_test.shape)
print(y_train.shape)
print(y_test.shape)
~~~

~~~
(316, 1)
(80, 1)
(316,)
(80,)
~~~

###### 데이터 분석 수행
- 사이킷런의 선형 회귀분석 모듈인 LinearRegression을 사용
	- LinearRegression 객체를 생성하고 fit() 함수에 학습용 데이터(X_train)와 결정값 데이터(y_train) 를 입력해 호출하면 학습이 수행된다.
- 최적 선형 회귀식 계수 a, b를 도출
	- 회귀식의 기울기인 a는 lr.coef_ 에, y절편인 b는 lr.intercept_ 에 저장된다.
~~~python
## 6. 데이터분석 수행
# LinearRegression 객체 생성
lr = LinearRegression()
lr.fit(X_train, y_train)        # 학습 수행

# 회귀식의 기울기와 y절편 출력
print("기울기 a: ", lr.coef_)
print("y 절편 b: ", lr.intercept_)

# 학습이 완료된 lr객체에서 테스트 데이터셋으로 예측 수행
pred = lr.predict(X_test)
~~~

~~~
기울기 a:  [-0.00774371]
y 절편 b:  46.62501834798047
~~~
###### 성능평가 및 시각화
- 선형 회귀분석 평가는 결정계수인 $R^2$ 점수로 예측 정확도를 판단할 수 있다.
	- 사이킷런의 r2_score() 함수를 사용한다.
	- 첫번째 파라미터로 목표변수에 대한 테스트 데이터셋(y_test), 두번째 파라미터로 분석 결과로 예측된 데이터셋(pred)을 입력한다.
	- 실행결과 $R^2$ 값이 0.7015...로 정확도는 70% 이상임을 알 수 있다,
~~~python
## 7. 성능평가 및 시각화
# 모델 성능 평가 - 테스트 데이터셋
from sklearn.metrics import r2_score
score = r2_score(y_test, pred)
print(score)                        # 테스트 정확도는 70% 이상임이 확인됨
~~~

~~~
0.7015633872576372
~~~

- horsepower-mpg 분석
~~~python
## 추가작업 해보기 (horsepower-mpg 분석)

## 5. 분석 데이터 셋 준비
X = df[["horsepower"]]
y = df["mpg"]

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=10)

print(X_train.shape)
print(X_test.shape)
print(y_train.shape)
print(y_test.shape)

## 6. 데이터 분석 수행
lr = LinearRegression()
lr.fit(X_train,y_train)

print("기울기 a:", lr.coef_)
print("y 절편 b:", lr.intercept_)
pred = lr.predict(X_test)

## 7. 성능평가 및 시각화
from sklearn.metrics import r2_score
score = r2_score(y_test, pred)
print(score)

~~~

~~~
기울기 a: [-0.16035108]
y 절편 b: 40.313418327064824

0.6039842414538836
~~~
###### (참고) 상관관계 분석
- 독립변수와 종속변수 사이에 선형관계 유무는 산점도를 통해서도 가능하지만, 상관분석을 이용해서 정확하게 파악할 수 있다.
- 상관관계를 구하는 여러가지 방법 중에서 '피어슨 상관계수'를 많이 사용한다.
- 판다스 데이터프레임의 corr() 메소드를 이용한 상관관계 분석
	- 0.7 이상이 강한 상관관계를 가지고 있다고 기준을 정의할 경우 총 4개의 컬럼이 상관관계가 mpg와 상관관계가 있다고 판단할 수 있다.
~~~python
## 8. 상관관계 분석
# 변수들 간의 상관관계 분석
corr = df.corr(method="pearson")
print(corr)
~~~

~~~
                   mpg  cylinders  displacement  horsepower    weight  \
mpg           1.000000  -0.775680     -0.804711   -0.777575 -0.832725   
cylinders    -0.775680   1.000000      0.950706    0.843751  0.896058   
displacement -0.804711   0.950706      1.000000    0.897787  0.932729   
horsepower   -0.777575   0.843751      0.897787    1.000000  0.864350   
weight       -0.832725   0.896058      0.932729    0.864350  1.000000   
acceleration  0.421159  -0.504844     -0.542713   -0.687241 -0.415462   
model-year    0.581144  -0.352554     -0.374620   -0.420697 -0.311774   

              acceleration  model-year  
mpg               0.421159    0.581144  
cylinders        -0.504844   -0.352554  
displacement     -0.542713   -0.374620  
horsepower       -0.687241   -0.420697  
weight           -0.415462   -0.311774  
acceleration      1.000000    0.294588  
model-year        0.294588    1.000000  
~~~


# 출처


# 관련 노트
[[지도학습]]
[[다중 선형 회귀분석]]

# 외부 링크

