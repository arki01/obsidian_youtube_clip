---
Created: 2023-11-08 03:23
tags:
  - AI/머신러닝
aliases:
  - 결측치 처리
---

# 개요
데이터 전처리 과정 중 하나로 결측값(결측치)란 데이터 값이 없는 것을 뜻하며, 그에 대한 처리 방법을 설명한다.

# 내용
### 개론
- 결측치란 말 그대로 데이터에 값이 없는 것을 뜻한다. 줄여서 NA라고도 하고, Null 이라는 표현도 쓴다.
- 빠진 값을 처리하는 것을 말한다.
- 결측값에는 무작위 결측(MAR)과 비무작위 결측(NMAR)이 있으며, 비무작위 결측의 경우 결측값이 결과값에 영향을 주므로 데이터 정제 시 주의해야한다.
- 처리 방법으로는 항목을 모두 버리거나, 적절한 값으로 대체, 또는 NaN으로 표시하여 분석단계로 결측치를 넘기는 방법도 있다.

### 처리방법
#### 결측치 확인 및 제거
- 결측치가 포함되어 있는지를 확인 : isnull()
- 각 컬럼에 대한 결측치 추가 확인 : sum(), info()
- 결측치가 있는 행 전체를 제거 : dropna()
~~~ python
df = pd.read_csv("http://raw.githubusercontent.com/datasciencedojo/datasets/master/titanic.csv")

# 결측치 확인
print(df.isnull().sum())    # Column별 결측치 확인 갯수 확인
df.info()                   # 데이터프레임 구조 확인 - Column별 결측치 갯수가 확인 가능하다

# 결측치 제거
df_1 = df.dropna(axis=0)
print(df_1.isnull().sum().sum())        # 데이터프레임 결측치 전체
df_1.shape                              # 데이터프레임 크기
~~~

#### 결측치 대체
- 결측치를 지정값으로 대체 : fillna()
~~~ python
# 결측치 대체 - Age 컬럼의 결측치를 평균으로 대체
print(df["Age"].isnull().sum())   
age_mean = df["Age"].mean()
df["Age"].fillna(age_mean, inplace=True)      # Age 컬럼의 결측치를 평균으로 대체
print(df["Age"].isnull().sum())               # Age 컬럼의 결측치 개수

# 결측치 대체 - Embarked 컬럼의 결측치를 최빈값으로 대체
from scipy.stats import mode

print(df["Embarked"].isnull().sum())
embarked_mode = df["Embarked"].mode()                   # Embarked 컬럼의 최빈값
df["Embarked"].fillna(embarked_mode[0], inplace=True)   # Embarked 컬럼의 결측치를 최빈값으로 대체
print(df["Embarked"].isnull().sum())                    # 대체 후 Embarked 컬럼의 결측치 개수

# 결측치 대체 - Age 컬럼의 결측치를 그룹별 평균값으로 대체
df["Age"].fillna(df.groupby("Pclass")["Age"].transform("mean"), inplace=True)
~~~

### 예제
#### 결측치 처리
-  주어진 데이터에서 결측치가 80%이상 되는 컬럼은(변수는) 삭제하고, 80% 미만인 결측치가 있는 컬럼은 'city'별 중앙값으로 값을 대체하고 'f1'컬럼의 평균값을 출력하세요!
- 데이터셋 : basic1.csv 오른쪽 상단 copy&edit 클릭 -> 예상문제 풀이 시작
- 강의 영상 : https://youtu.be/WqlpqBRn7x4

~~~ python
# 라이브러리 및 데이터 불러오기
import pandas as pd
import numpy as np

df = pd.read_csv('../input/bigdatacertificationkr/basic1.csv')
~~~

~~~ python
# EDA - 결측값 확인(비율 확인)
print(df.info(), '\n')
print(df.isnull().sum()/df.shape[0], '\n')
print(df.isnull().sum(), '\n')
~~~

~~~
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 100 entries, 0 to 99
Data columns (total 7 columns):
 #   Column  Non-Null Count  Dtype  
---  ------  --------------  -----  
 0   id      100 non-null    object 
 1   age     100 non-null    float64
 2   city    100 non-null    object 
 3   f1      69 non-null     float64
 4   f2      100 non-null    int64  
 5   f4      100 non-null    object 
 6   f5      100 non-null    float64
dtypes: float64(3), int64(1), object(3)
memory usage: 5.6+ KB
None 

id      0.00
age     0.00
city    0.00
f1      0.31
f2      0.00
f4      0.00
f5      0.00
dtype: float64 

id       0
age      0
city     0
f1      31
f2       0
f4       0
f5       0
dtype: int64 
~~~

~~~ python
# 80%이상 결측치 컬럼, 삭제
df = df.drop(['f3'], axis=1)
~~~

~~~ python
# 80%미만 결측치 컬럼, city별 중앙값으로 대체
print(df['city'].unique())
seoul_med = df[df['city']=='서울']['f1'].median()
busan_med = df[df['city']=='부산']['f1'].median()
daegu_med = df[df['city']=='대구']['f1'].median()
kyung_med = df[df['city']=='경기']['f1'].median()
seoul_med,busan_med,daegu_med,kyung_med
~~~

~~~
['서울' '부산' '대구' '경기']
(68.0, 62.0, 75.0, 58.0)
~~~

~~~ python
# f1 평균값 대체
df[df['city']=='서울']['f1'].fillna(seoul_med)
df[df['city']=='부산']['f1'].fillna(busan_med)
df[df['city']=='대구']['f1'].fillna(daegu_med)
df[df['city']=='경기']['f1'].fillna(kyung_med)

# 방법2
# df['f1'] = df['f1'].fillna(df['city'].map({'서울':s,'경기':k,'부산':b,'대구':d}))
~~~

~~~ python
# f1 평균값 결과 출력
df['f1'].mean()
~~~

~~~ 
65.52
~~~

#### 누적합 그리고 보간(결측치 처리)
- 주어진 데이터 셋에서 'f2' 컬럼이 1인 조건에 해당하는 데이터의 'f1'컬럼 누적합을 계산한다. 이때 발생하는 누적합 결측치는 바로 뒤의 값을 채우고, 누적합의 평균값을 출력한다. (단, 결측치 바로 뒤의 값이 없으면 다음에 나오는 값을 채워넣는다)

~~~ python
# 라이브러리 및 데이터 불러오기
import pandas as pd
import numpy as np

df = pd.read_csv('../input/bigdatacertificationkr/basic1.csv')
df.head(2)
df
~~~

~~~ python
# 조건에 따른 누적합
df2 = df[df['f2']==1].cumsum
~~~

~~~ 
<bound method NDFrame._add_numeric_operations.<locals>.cumsum of       id   age city     f1  f2   f3    f4         f5
1   id02   9.0   서울   70.0   1  NaN  ENFJ  60.339826
2   id03  27.0   서울   61.0   1  NaN  ISTJ  17.252986
6   id07  36.3   서울   60.0   1  NaN  ISFJ   9.796378
7   id08  38.0   서울  101.0   1  NaN  INFJ  83.685380
9   id10  95.0   서울   74.0   1  NaN  ISFP  98.429899
13  id14  77.0   서울   50.0   1  NaN  ENTJ  67.886373
14  id15  22.0   서울   67.0   1  NaN  ENTP   9.796378
16  id17  74.0   서울    NaN   1  NaN  ISTP  67.886373
19  id20  11.0   서울   51.0   1  NaN  INTJ  91.297791
20  id21  90.0   부산    NaN   1  NaN  ISFP  29.269869
21  id22  -6.3   부산   72.0   1  NaN  ENFP  52.667078
22  id23  34.0   부산   75.0   1  NaN  ISTP  69.730313
25  id26  55.0   부산   57.0   1  NaN  ENFP  83.685380
27  id28  38.0   부산   34.0   1  NaN  ENTP  80.138280
33  id34  65.0   부산    NaN   1  NaN  INFP  48.431184
35  id36  68.0   부산   77.0   1  NaN  INTP  13.049921
37  id38  87.0   부산    NaN   1  NaN  ESTP  83.685380
46  id47  34.6   대구   75.0   1  NaN  ESTJ  90.496999
49  id50  86.0   대구   78.0   1  NaN  ENFP  60.339826
51  id52  97.0   대구   82.0   1  NaN  ISFJ  90.496999
53  id54  53.0   대구    NaN   1  NaN  ENFJ  69.730313
55  id56  59.0   대구    NaN   1  vip  ESTJ  73.586397
58  id59  64.0   대구    NaN   1  NaN  ESFJ  20.129444
62  id63  88.0   경기   86.0   1  NaN  ISFJ  73.586397
65  id66  87.0   경기    NaN   1  NaN  ISFP  17.252986
66  id67  66.0   경기   52.0   1  NaN  ISFJ  73.586397
69  id70  -9.0   경기   96.0   1  NaN  ISTP  48.431184
72  id73  90.0   경기    NaN   1  NaN  ISFJ  73.586397
77  id78  92.0   경기   96.0   1  NaN  INTJ  69.730313
80  id81  86.0   경기   50.0   1  NaN  ISFJ  37.113739
82  id83  73.0   경기   50.0   1  vip  ENTP  80.138280
86  id87  19.0   경기    NaN   1  NaN  ISFP  97.381034
88  id89  34.0   경기   66.0   1  NaN  ENTJ  33.308999
91  id92  97.0   경기   78.0   1  NaN  INFP  97.381034
93  id94  84.0   경기    NaN   1  NaN  ESTJ  90.496999
94  id95  77.0   경기   43.0   1  NaN  INTJ  91.297791
95  id96  92.0   경기   53.0   1  NaN  ENTJ  52.667078>
~~~

~~~ python
# 결측치 처리 (뒤에 나오는 값으로 채움)
df2 = df.fillna(method='bfill')
~~~

~~~ python
# 조건에 따른 누적합
df2 = df[df['f2']==1]['f1'].cumsum()
~~~

~~~ python
# 결측치 처리 (뒤에 나오는 값으로 채움)
df2 = df2.fillna(method = 'bfill')
~~~

~~~
id	age	city	f1	f2	f3	f4	f5
0	id01	2.0	서울	70.0	0	vip	ENFJ	91.297791
1	id02	9.0	서울	70.0	1	vip	ENFJ	60.339826
2	id03	27.0	서울	61.0	1	vip	ISTJ	17.252986
3	id04	75.0	서울	85.0	2	vip	INFP	52.667078
4	id05	24.0	서울	85.0	2	vip	ISFJ	29.269869
...	...	...	...	...	...	...	...	...
95	id96	92.0	경기	53.0	1	vip	ENTJ	52.667078
96	id97	100.0	경기	58.0	0	vip	INFP	67.886373
97	id98	39.0	경기	58.0	2	vip	INFP	98.429899
98	id99	1.0	경기	47.0	0	vip	ESFJ	97.381034
99	id100	47.0	경기	53.0	0	vip	ESFP	33.308999
~~~

~~~ python
# 평균 출력
print(df2.mean())
~~~


# 출처


# 관련 노트
[[이상값 처리]]

# 외부 링크
- 예제문제 : https://www.kaggle.com/code/agileteam/py-t1-3-map-expected-questions/notebook
