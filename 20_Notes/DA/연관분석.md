---
Created: 2023-10-22 22:22
tags:
  - AI/머신러닝
---

# 개요
비지도학습 중 하나의 알고리즘으로 둘 이상의 항목들로 구성된 연관성 규칙을 도출하는 분석이다. 장바구니 분석으로 알려져 있으며, 규칙을 발견하기 위해 지지도, 신뢰도, 향상도를 평가척도로 사용한다.

# 내용
### 개념
- 상품이나 서비스를 구매하는 등의 일련의 거래 데이터 안에 존재하는 일정한 연관 규칙을 발견하는 과정이다.
- 연관 규칙이란 '만약 A항목을 구매했다면 B항목 또한 구매할 것이다' 라는 If A then B의 형태로 표현되는 패턴을 말한다.
- 주로 거래내역 데이터의 구매항목간에 존재하는 연관성에 대한 규칙을 추론하므로 장바구니 분석이라고도 한다.
### 측정 지표
- 지지도 : 데이터 전체에서 해당 물건을 고객이 구입하는 확률
- 신뢰도 : 어떤 데이터를 구매했을 때 다른 제품이 구매될 조건부 확률
- 향상도 : 두 물건의 구입 여부가 독립인지 확인하는 개념으로 1이면 상호 독립적인 간계, 1보다 크면 양의 상관관계, 1보다 작으면 음의 상관관계다.
### 알고리즘
- apriori 알고리즘
	- 지지도를 사용해 빈발 아이템 집합을 판별하고 계산의 복잡도를 감소시키는 알고리즘
	- '품목 A의 지지도가 최소지지도보다 작다면 품목 A를 포함하는 모든 아이템 집합의 지지도는 최소지지도보다 작을 것이다.' 라는 아이디어를 바탕으로 부분집합 수를 줄임으로써 계산의 복잡도를 감소시킨다.
- FP-Growth 알고리즘
	- FP-Tree라는 구조를 통해 최소지지도를 만족하는 빈발 아이템 집합을 추출할 수 있는 알고리즘이다. 
### 분석 수행
- 분석 목표
	- 장바구니 구매 물품 데이터 셋으로 물품들 간의 연관관계를 파악하고 성능을 평가해본다.
- 접근 방법
	- 장바구니 구매항목별 관련성이 있는지 알아보기 위해 Apriori 알고리즘으로 연관분석을 적용한다.

###### 필요 패키지 임포트
~~~python
## 연관분석 알고리즘

## 1. 필요 패키지 임포트
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

# apriori, association_rules 모듈 호출
from mlxtend.frequent_patterns import apriori, association_rules
~~~

###### 데이터 불러오기
~~~python
## 2. 데이터 불러오기
from google.colab import drive
drive.mount('/content/drive')

# pandas의 read_csv 함수 통한 csv 데이터 로드
df = pd.read_csv('/content/drive/MyDrive/Colab Notebooks/retail_dataset.csv', sep=',')
~~~

###### 데이터 살펴보기
~~~python
## 3. 데이터 살펴보기
df.info()
~~~

###### 데이터 전처리
- 장바구니 목록 값을 수치로 표현하기 위해 항목당 매칭될 경우 1로, 아니면 0으로 표시한다. (원-핫 인코딩 처리)
~~~python
## 4. 데이터 전처리
# 장바구니 데이터 고유항목 구분 출력
items = set()
for col in df:
  items.update(df[col].unique())

items

# 장바구니 목록 값(텍스트)을 수치로 표현-각 항목당 매칭될 경우 1로, 아니면 0으로 표시(one-hot encoding)
itemset = set(items)
encoding = []
for index, row in df.iterrows():
  rowset = set(row)
  labels = {}
  dismatching = list(itemset - rowset)
  matching = list(itemset.intersection(rowset))
  for i in dismatching:
    labels[i] = 0
  for j in matching:
    labels[j] = 1
  encoding.append(labels)
encoding[0]
result = pd.DataFrame(encoding)

result
~~~
|Milk|Bagel|Eggs|Meat|Pencil|Cheese|Wine|Bread|Diaper|
|---|---|---|---|---|---|---|---|---|
|0|0|0|1|1|1|1|1|1|1|
|1|1|0|0|1|1|1|1|1|1|
|2|1|0|1|1|0|1|1|0|0|
|3|1|0|1|1|0|1|1|0|0|
|4|0|0|0|1|1|0|1|0|0|
|...|...|...|...|...|...|...|...|...|...|
|310|0|0|1|0|0|1|0|1|0|
|311|1|0|0|1|1|0|0|0|0|
|312|0|0|1|1|1|1|1|1|1|
|313|0|0|0|1|0|1|0|0|0|
|314|0|1|1|1|0|0|1|1|0|

315 rows × 9 columns
###### 분석 데이터셋 준비
~~~python
## 5. 분석 데이터셋 준비
# 첫째 NaN 열항목 삭제
result = result.drop(result.columns[0], axis=1)         
display(result)
~~~

###### 데이터 분석 수행
- mlxtend의 apriori 클래스 사용
	- apriori() 함수로 장바구니 구매 데이터를 연관분석한다.
- association_rules() 함수를 통해 연관분석 결과에서 규칙(신뢰도 임계치 0.6 기반)을 도출
	- (Baegel, Bread)와 같이 상호연관성이 높은 구매항목들이 출력된다.
	- 신뢰도가 높다는 것은 구매 품목들의 연관성이 높음을 의미한다.
~~~python
## 6. 데이터분석 수행
# apriori 함수 적용
freq_items = apriori(result , min_support=0.2, use_colnames=True)

# association_rules로 규칙 도출(신뢰도 임계치 0.6 기반)
rules = association_rules(freq_items, metric="confidence", min_threshold=0.6)
rules.head()
~~~

||antecedents|consequents|antecedent support|consequent support|support|confidence|lift|leverage|conviction|
|---|---|---|---|---|---|---|---|---|---|
|0|(Cheese)|(Milk)|0.501587|0.501587|0.304762|0.607595|1.211344|0.053172|1.270148|
|1|(Milk)|(Cheese)|0.501587|0.501587|0.304762|0.607595|1.211344|0.053172|1.270148|
|2|(Bagel)|(Bread)|0.425397|0.504762|0.279365|0.656716|1.301042|0.064641|1.442650|
|3|(Eggs)|(Meat)|0.438095|0.476190|0.266667|0.608696|1.278261|0.058050|1.338624|
|4|(Eggs)|(Cheese)|0.438095|0.501587|0.298413|0.681159|1.358008|0.078670|1.563203|

# 출처


# 관련 노트


# 외부 링크

