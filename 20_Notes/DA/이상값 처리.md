---
Created: 2023-11-08 02:34
tags:
  - AI/머신러닝
aliases:
  - 이상치 처리
---

# 개요
데이터 전처리 과정 중 하나로 이상값(이상치)는 정상의 범주에서 벗어난 값을 의미하며, 이에 대한 처리 방식을 설명한다.

# 내용

### 개론
- 이상값(이상치)란?
	- 데이터의 전처리 과정에서 발생 가능한 문제로 정상의 범주에서 벗어난 값을 특별한 값을 갖는 것을 말한다.
- 이상값 검출 방법
	- 분산 : 정규분포의 97.5% 이상, 2.5%미만을 이상값이라 할 수 있다.
	- 우도 : 관측치가 가장 많이 발견될 것으로 보이는 경위의 확률값을 '우도'라고 하며, 우도가 낮을 수록 이상값에 가깝다고 할 수 있다.
	- 근접 이웃 기반 이상치 탐지(NN, [[KNN (K-Neareat Neighbor)|KNN]]) : 정상값의 중심으로 부터 거리가 미리 정해진 임곗값보다 큰 경우 이상치로 본다.
	- 사분위수 : 일반적으로 사분범위에서 1.5 사분범위수(IQR)를 벗어나는 경우를 이상치로 판단한다. (Q1-1.5IQR, Q3+1.5IQR)
	  ![[빅데이터 분석_IQR(Inter Quantile Range).png]]
	- 그밖에도 밀도, 군집 등의 방법으로 이상치로 검출하는데, 분석기사에서는 사분위수를 가장 많이 채택하는 편이다.
- 이상값 처리 방법
	- 삭제, 대체, 스케일링, [[정규화 (Normalization)|정규화]] 등의 방법이 있다.

### 처리방법

~~~ python
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt           # 맷플롯립 패키지 임포트

# 정규분포 평균 50, 표준편차 10을 가지는 데이터 200개 생성 -> 데이터프레임으로 변환
data = 10 * np.random.randn(200) + 50
df = pd.DataFrame({"값":data})

# 임의의 이상치 삽입
df.loc[201] = 2
df.loc[202] = 100
df.loc[203] = 10
df.loc[204] = 110

# 분포 시각화
plt.hist(df["값"], bins=20, rwidth=0.8)
plt.show()

# IQR(Intgerquartile Range, 사분위범위) 방법
# 박스플롯
plt.boxplot(df["값"])
plt.show()

Q1 = df["값"].quantile(.25)       # 1사분위수
Q2 = df["값"].quantile(.5)        # 2사분위수
Q3 = df["값"].quantile(.75)       # 3사분위수
IQR = Q3 - Q1                     # 사분위범위

lowerOutlier = df.loc[(df["값"] < (Q1 - IQR * 1.5))]
upperOutlier = df.loc[(df["값"] > (Q3 + IQR * 1.5))]

print(lowerOutlier)
print(upperOutlier)
~~~

### 예제
#### 이상치를 찾아라
데이터에서 IQR을 활용해 Fare컬럼의 이상치를 찾고, 이상치 데이터의 여성 수를 구하시오
- 강의 영상 : https://youtu.be/ipBW5D_UJEo
- 데이터셋 : titanic 
- 오른쪽 상단 copy&edit 클릭 -> 예상문제 풀이 시작
- 데이터 위치 "../input/titanic/train.csv" (copy&edit가 아닐 경우 별도로 데이터셋 불러와야 함

~~~ python
# 라이브러리 및 데이터 불러오기
import pandas as pd
import numpy as np
df = pd.read_csv('../input/titanic/train.csv')
~~~

~~~ python
# 간단한 탐색적 데이터 분석 (EDA)
print(df.shape)
print(df.isnull().sum())
df.describe()
df.head
~~~

~~~python
# IQR 구하기
Q1 = df['Fare'].quantile(.25)
Q3 = df['Fare'].quantile(.75)

IRQ = Q3-Q1
Q1 - 1.5*IQR, Q3+1.5*IQR
~~~

~~~
(-26.724, 65.6344)
~~~

~~~python
# 이상치 데이터 구하기
outdata1 = df[df['Fare']<(Q1-1.5*IQR)]
outdata2 = df[df['Fare']>(Q3+1.5*IQR)]
len(outdata1), len(outdata2)
~~~

~~~
(0, 116)
~~~

~~~python
# 이상치 데이터에서 여성 수 구하기, 출력하기 print()
print(sum(outdata2['Sex'] == 'female'))
~~~

~~~
70
~~~



# 출처


# 관련 노트
[[결측값 처리]]

# 외부 링크
- 예제문제 : https://www.kaggle.com/code/beepak/py-t1-1-iqr-expected-questions/edit

